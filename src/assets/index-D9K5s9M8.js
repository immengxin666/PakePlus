import{r as H}from"./request-Taj1ukFo.js";import{g as J,u as W,a as X,d as Y}from"./index-edeq_iRc.js";import{d as Z,u as ee,r as b,a as I,c as x,b as t,w as a,e as o,o as c,F as R,f as q,g as z,h as d,t as le,i as y,j as te,E as k,k as ae,_ as ne}from"./index-D4WkKyn4.js";const oe=F=>H({url:"/dishes-service/dict/list",method:"GET",params:{type:F}}),re=["src"],se=Z({__name:"index",setup(F){const B=ee(),V=void 0,S=b(),C=b([]),s=I({pageNum:1,pageSize:10,total:0,list:[]}),f=I({name:"",type:""}),w=b(),n=b({}),E=I({name:[{required:!0,message:"请输入食材名称",trigger:"blur"}],type:[{required:!0,message:"请选择食材类型",trigger:"blur"}],url:[{required:!0,message:"请上传食材图片",trigger:"change"}],description:[{required:!0,message:"请输入食材描述",trigger:"blur"}]}),p=b(!1),T=(r,e,v)=>{r.code===200?n.value.url=r.data:(n.value.url="",k.error("上传图片失败: "+r.msg))},i=()=>{J(s.pageNum,s.pageSize,f).then(r=>{s.list=r.rows,s.total=r.total})};(()=>{oe("ingredients").then(r=>{C.value=r})})(),i();const $=()=>{var r;(r=w.value)==null||r.validate(e=>{e&&(n.value.id?W(n.value.id,{...n.value}).then(v=>{k.success("更新食材成功"),p.value=!1,i()}):X(n.value).then(v=>{k.success("添加食材成功"),p.value=!1,i()}))})},D=r=>{ae.confirm("确定要删除这个食材吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Y(r).then(()=>{k.success("删除成功"),i()})}).catch(()=>{k.info("已取消删除")})};return(r,e)=>{const v=o("el-input"),m=o("el-form-item"),N=o("el-option"),U=o("el-select"),g=o("el-button"),A=o("el-form"),_=o("el-table-column"),P=o("el-tag"),L=o("el-image"),j=o("el-table"),M=o("el-pagination"),Q=o("Plus"),h=o("el-icon"),G=o("el-upload"),K=o("el-dialog");return c(),x("div",null,[t(A,{ref_key:"queryFormRef",ref:S,model:f,"label-width":"auto",inline:""},{default:a(()=>[t(m,{label:"食材名称",prop:"name"},{default:a(()=>[t(v,{placeholder:"请输入食材名称",modelValue:f.name,"onUpdate:modelValue":e[0]||(e[0]=l=>f.name=l),clearable:"",class:"w-50!"},null,8,["modelValue"])]),_:1}),t(m,{label:"食材类型",prop:"type"},{default:a(()=>[t(U,{modelValue:f.type,"onUpdate:modelValue":e[1]||(e[1]=l=>f.type=l),placeholder:"请选择食材类型",clearable:"",class:"w-50!"},{default:a(()=>[(c(!0),x(R,null,q(C.value,l=>(c(),z(N,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(g,{type:"primary",onClick:i,icon:"Search"},{default:a(()=>e[13]||(e[13]=[d("搜索")])),_:1,__:[13]}),t(g,{type:"default",onClick:e[2]||(e[2]=l=>{var u;return(u=S.value)==null||u.resetFields(),s.pageNum=1,i()}),icon:"Refresh"},{default:a(()=>e[14]||(e[14]=[d("重置")])),_:1,__:[14]}),t(g,{type:"success",onClick:e[3]||(e[3]=l=>p.value=!0),icon:"Plus"},{default:a(()=>e[15]||(e[15]=[d("添加")])),_:1,__:[15]})]),_:1})]),_:1},8,["model"]),t(j,{data:s.list,border:"",height:"750px"},{default:a(()=>[t(_,{label:"序号",width:"80",type:"index",align:"center"}),t(_,{label:"食材名称",prop:"name",align:"center"}),t(_,{label:"食材类型",prop:"type",align:"center"},{default:a(l=>[t(P,{type:"primary"},{default:a(()=>{var u;return[d(le((u=C.value.find(O=>O.value===l.row.type))==null?void 0:u.label),1)]}),_:2},1024)]),_:1}),t(_,{label:"食材图片",prop:"url",align:"center"},{default:a(({row:l})=>[t(L,{style:{width:"100px"},src:y(V)+l.url,"preview-src-list":[y(V)+l.url],"preview-teleported":""},null,8,["src","preview-src-list"])]),_:1}),t(_,{label:"创建时间",prop:"createTime",align:"center"}),t(_,{label:"操作",align:"center"},{default:a(({row:l})=>[t(g,{type:"primary",onClick:u=>(n.value={...l},p.value=!0),icon:"Edit"},{default:a(()=>e[16]||(e[16]=[d("修改")])),_:2,__:[16]},1032,["onClick"]),t(g,{type:"danger",onClick:u=>D(l.id),icon:"Delete"},{default:a(()=>e[17]||(e[17]=[d("删除")])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(M,{"current-page":s.pageNum,"onUpdate:currentPage":e[4]||(e[4]=l=>s.pageNum=l),"page-size":s.pageSize,"onUpdate:pageSize":e[5]||(e[5]=l=>s.pageSize=l),"page-sizes":[5,10,20,30],background:"",class:"mt-5!",layout:"total, sizes, prev, pager, next, jumper",total:s.total,onSizeChange:e[6]||(e[6]=l=>(s.pageNum=1,i())),onCurrentChange:i},null,8,["current-page","page-size","total"]),t(K,{title:n.value.id?"编辑食材":"新增食材",width:"400px",modelValue:p.value,"onUpdate:modelValue":e[11]||(e[11]=l=>p.value=l),onClose:e[12]||(e[12]=l=>{var u;return n.value={},(u=w.value)==null?void 0:u.resetFields()})},{footer:a(()=>[te("div",null,[t(g,{size:"small",onClick:e[10]||(e[10]=l=>p.value=!1)},{default:a(()=>e[18]||(e[18]=[d("取 消")])),_:1,__:[18]}),t(g,{size:"small",type:"primary",onClick:$},{default:a(()=>e[19]||(e[19]=[d("确 定")])),_:1,__:[19]})])]),default:a(()=>[t(A,{ref_key:"addIngredientsFormRef",ref:w,model:n.value,rules:E,"label-width":"auto"},{default:a(()=>[t(m,{label:"食材名称",prop:"name"},{default:a(()=>[t(v,{placeholder:"请输入食材名称",modelValue:n.value.name,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.name=l),clearable:""},null,8,["modelValue"])]),_:1}),t(m,{label:"食材类型",prop:"type"},{default:a(()=>[t(U,{modelValue:n.value.type,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.type=l),placeholder:"请选择食材类型",clearable:""},{default:a(()=>[(c(!0),x(R,null,q(C.value,l=>(c(),z(N,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"食材图片",prop:"url"},{default:a(()=>[t(G,{class:"avatar-uploader",action:y(V)+"/dishes-service/dishes/image",headers:{Authorization:y(B).TOKEN},"show-file-list":!1,"on-success":T},{default:a(()=>[n.value.url?(c(),x("img",{key:0,src:y(V)+n.value.url,class:"avatar"},null,8,re)):(c(),z(h,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[t(Q)]),_:1}))]),_:1},8,["action","headers"])]),_:1}),t(m,{label:"食材描述",prop:"description"},{default:a(()=>[t(v,{type:"textarea",placeholder:"请输入食材描述",modelValue:n.value.description,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.description=l),rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}}),me=ne(se,[["__scopeId","data-v-cc54d4c4"]]);export{me as default};
