import{b as R}from"./index-edeq_iRc.js";import{g as h,u as ee,a as le,d as ae}from"./index-B4NkgLwq.js";import{d as te,r as f,u as ne,a as T,l as oe,c as b,b as a,w as t,e as o,F as C,f as U,h as m,i as z,t as D,g as w,j as p,E as F,k as ue,o as u,_ as se}from"./index-D4WkKyn4.js";import"./request-Taj1ukFo.js";const re=["src"],ie={class:"ingredient-row"},de={class:"ingredient-row"},me={class:"ingredient-row"},pe=te({__name:"index",setup(ge){const $=f(),_=f([]),M=ne(),s=T({pageNum:1,pageSize:10,total:0,list:[]}),d=T({name:"",main:void 0,minor:void 0,seasoning:void 0}),q=f(),n=f({}),j=T({name:[{required:!0,message:"请输入菜品名称",trigger:"blur"}],url:[{required:!0,message:"请上传菜品图片",trigger:"change"}],main:[{required:!0,message:"请选择主要食材",trigger:"blur"}],mainNum:[{required:!0,message:"请输入主要食材份量",trigger:"blur"}],minor:[{required:!0,message:"请选择辅助食材",trigger:"blur"}],minorNum:[{required:!0,message:"请输入辅助食材份量",trigger:"blur"}],seasoning:[{required:!0,message:"请选择配料",trigger:"blur"}],seasoningNum:[{required:!0,message:"请输入配料份量",trigger:"blur"}],description:[{required:!0,message:"请输入菜品描述",trigger:"blur"}]}),y=f(!1),A=(r,l,x)=>{r.code===200?n.value.url=r.data:(n.value.url="",F.error("上传图片失败: "+r.msg))},g=()=>{h(s.pageNum,s.pageSize,d).then(r=>{s.list=r.rows,s.total=r.total})},E=f([]),L=f([]),I=f([]),Q=async()=>{E.value=await R("1"),L.value=await R("2"),I.value=await R("3"),_.value=[...E.value,...L.value,...I.value]};oe(async()=>{await Q(),g()});const K=()=>{var r;(r=q.value)==null||r.validate(l=>{l&&(n.value.id?ee(n.value.id,{...n.value}).then(x=>{F.success("更新菜品成功"),y.value=!1,g()}):le(n.value).then(x=>{F.success("添加菜品成功"),y.value=!1,g()}))})},O=r=>{ue.confirm("确定要删除这个菜品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ae(r).then(()=>{F.success("删除成功"),g()})}).catch(()=>{F.info("已取消删除")})};return(r,l)=>{const x=o("el-input"),i=o("el-form-item"),N=o("el-option"),k=o("el-select"),V=o("el-button"),P=o("el-form"),v=o("el-table-column"),G=o("el-image"),S=o("el-tag"),H=o("el-table"),J=o("el-pagination"),W=o("Plus"),X=o("el-icon"),Y=o("el-upload"),B=o("el-input-number"),Z=o("el-dialog");return u(),b("div",null,[a(P,{ref_key:"queryFormRef",ref:$,model:d,"label-width":"auto",inline:""},{default:t(()=>[a(i,{label:"菜品名称",prop:"name"},{default:t(()=>[a(x,{placeholder:"请输入菜品名称",modelValue:d.name,"onUpdate:modelValue":l[0]||(l[0]=e=>d.name=e),clearable:"",class:"w-50!"},null,8,["modelValue"])]),_:1}),a(i,{label:"主要食材",prop:"main"},{default:t(()=>[a(k,{modelValue:d.main,"onUpdate:modelValue":l[1]||(l[1]=e=>d.main=e),placeholder:"请选择主要食材",clearable:"",class:"w-50!"},{default:t(()=>[(u(!0),b(C,null,U(_.value,e=>(u(),w(N,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"辅助食材",prop:"minor"},{default:t(()=>[a(k,{modelValue:d.minor,"onUpdate:modelValue":l[2]||(l[2]=e=>d.minor=e),placeholder:"请选择辅助食材",clearable:"",class:"w-50!"},{default:t(()=>[(u(!0),b(C,null,U(_.value,e=>(u(),w(N,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"配料",prop:"seasoning"},{default:t(()=>[a(k,{modelValue:d.seasoning,"onUpdate:modelValue":l[3]||(l[3]=e=>d.seasoning=e),placeholder:"请选择配料",clearable:"",class:"w-50!"},{default:t(()=>[(u(!0),b(C,null,U(_.value,e=>(u(),w(N,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,null,{default:t(()=>[a(V,{type:"primary",onClick:g,icon:"Search"},{default:t(()=>l[20]||(l[20]=[m("搜索")])),_:1,__:[20]}),a(V,{type:"default",onClick:l[4]||(l[4]=e=>{var c;return(c=$.value)==null||c.resetFields(),s.pageNum=1,g()}),icon:"Refresh"},{default:t(()=>l[21]||(l[21]=[m("重置")])),_:1,__:[21]}),a(V,{type:"success",onClick:l[5]||(l[5]=e=>y.value=!0),icon:"Plus"},{default:t(()=>l[22]||(l[22]=[m("添加")])),_:1,__:[22]})]),_:1})]),_:1},8,["model"]),a(H,{data:s.list,border:"",height:"750px"},{default:t(()=>[a(v,{label:"序号",width:"80",type:"index",align:"center"}),a(v,{label:"菜品名称",prop:"name",align:"center"}),a(v,{label:"菜品图片",prop:"url",align:"center"},{default:t(({row:e})=>[a(G,{style:{width:"100px"},src:z(void 0)+e.url,"preview-src-list":[z(void 0)+e.url],"preview-teleported":""},null,8,["src","preview-src-list"])]),_:1}),a(v,{label:"主要食材",prop:"mainName",align:"center"},{default:t(e=>[a(S,{type:"primary"},{default:t(()=>[m(D(e.row.mainName)+" ("+D(e.row.mainNum)+"g)",1)]),_:2},1024)]),_:1}),a(v,{label:"辅助食材",prop:"minorName",align:"center"},{default:t(e=>[a(S,{type:"success"},{default:t(()=>[m(D(e.row.minorName)+" ("+D(e.row.minorNum)+"g)",1)]),_:2},1024)]),_:1}),a(v,{label:"配料",prop:"seasoningName",align:"center"},{default:t(e=>[a(S,{type:"warning"},{default:t(()=>[m(D(e.row.seasoningName)+" ("+D(e.row.seasoningNum)+"g)",1)]),_:2},1024)]),_:1}),a(v,{label:"创建时间",prop:"createTime",align:"center"}),a(v,{label:"操作",align:"center"},{default:t(({row:e})=>[a(V,{type:"primary",onClick:c=>(n.value={...e},y.value=!0),icon:"Edit"},{default:t(()=>l[23]||(l[23]=[m("修改")])),_:2,__:[23]},1032,["onClick"]),a(V,{type:"danger",onClick:c=>O(e.id),icon:"Delete"},{default:t(()=>l[24]||(l[24]=[m("删除")])),_:2,__:[24]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),a(J,{"current-page":s.pageNum,"onUpdate:currentPage":l[6]||(l[6]=e=>s.pageNum=e),"page-size":s.pageSize,"onUpdate:pageSize":l[7]||(l[7]=e=>s.pageSize=e),"page-sizes":[5,10,20,30],background:"",class:"mt-5!",layout:"total, sizes, prev, pager, next, jumper",total:s.total,onSizeChange:l[8]||(l[8]=e=>(s.pageNum=1,g())),onCurrentChange:g},null,8,["current-page","page-size","total"]),a(Z,{title:n.value.id?"编辑菜品":"新增菜品",width:"600px",modelValue:y.value,"onUpdate:modelValue":l[18]||(l[18]=e=>y.value=e),onClose:l[19]||(l[19]=e=>{var c;return n.value={},(c=q.value)==null?void 0:c.resetFields()})},{footer:t(()=>[p("div",null,[a(V,{size:"small",onClick:l[17]||(l[17]=e=>y.value=!1)},{default:t(()=>l[31]||(l[31]=[m("取 消")])),_:1,__:[31]}),a(V,{size:"small",type:"primary",onClick:K},{default:t(()=>l[32]||(l[32]=[m("确 定")])),_:1,__:[32]})])]),default:t(()=>[a(P,{ref_key:"addDishesFormRef",ref:q,model:n.value,rules:j,"label-width":"auto"},{default:t(()=>[a(i,{label:"菜品名称",prop:"name"},{default:t(()=>[a(x,{placeholder:"请输入菜品名称",modelValue:n.value.name,"onUpdate:modelValue":l[9]||(l[9]=e=>n.value.name=e),clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"菜品图片",prop:"url"},{default:t(()=>[a(Y,{class:"avatar-uploader",action:z(void 0)+"/dishes-service/dishes/image",headers:{Authorization:z(M).TOKEN},"show-file-list":!1,"on-success":A},{default:t(()=>[n.value.url?(u(),b("img",{key:0,src:z(void 0)+n.value.url,class:"avatar"},null,8,re)):(u(),w(X,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[a(W)]),_:1}))]),_:1},8,["action","headers"])]),_:1}),a(i,{label:"主要食材",prop:"main"},{default:t(()=>[p("div",ie,[a(k,{modelValue:n.value.main,"onUpdate:modelValue":l[10]||(l[10]=e=>n.value.main=e),placeholder:"请选择主要食材",style:{flex:"1","margin-right":"10px"}},{default:t(()=>[(u(!0),b(C,null,U(_.value,e=>(u(),w(N,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[25]||(l[25]=p("span",{class:"portion-label"},"份量",-1)),a(B,{modelValue:n.value.mainNum,"onUpdate:modelValue":l[11]||(l[11]=e=>n.value.mainNum=e),min:1,style:{width:"150px",margin:"0 10px"}},null,8,["modelValue"]),l[26]||(l[26]=p("span",null,"g",-1))])]),_:1}),a(i,{label:"辅助食材",prop:"minor"},{default:t(()=>[p("div",de,[a(k,{modelValue:n.value.minor,"onUpdate:modelValue":l[12]||(l[12]=e=>n.value.minor=e),placeholder:"请选择辅助食材",style:{flex:"1","margin-right":"10px"}},{default:t(()=>[(u(!0),b(C,null,U(_.value,e=>(u(),w(N,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[27]||(l[27]=p("span",{class:"portion-label"},"份量",-1)),a(B,{modelValue:n.value.minorNum,"onUpdate:modelValue":l[13]||(l[13]=e=>n.value.minorNum=e),min:1,style:{width:"150px",margin:"0 10px"}},null,8,["modelValue"]),l[28]||(l[28]=p("span",null,"g",-1))])]),_:1}),a(i,{label:"配料",prop:"seasoning"},{default:t(()=>[p("div",me,[a(k,{modelValue:n.value.seasoning,"onUpdate:modelValue":l[14]||(l[14]=e=>n.value.seasoning=e),placeholder:"请选择配料",style:{flex:"1","margin-right":"10px"}},{default:t(()=>[(u(!0),b(C,null,U(_.value,e=>(u(),w(N,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[29]||(l[29]=p("span",{class:"portion-label"},"份量",-1)),a(B,{modelValue:n.value.seasoningNum,"onUpdate:modelValue":l[15]||(l[15]=e=>n.value.seasoningNum=e),min:1,style:{width:"150px",margin:"0 10px"}},null,8,["modelValue"]),l[30]||(l[30]=p("span",null,"g",-1))])]),_:1}),a(i,{label:"菜品描述",prop:"description"},{default:t(()=>[a(x,{type:"textarea",placeholder:"请输入菜品描述",modelValue:n.value.description,"onUpdate:modelValue":l[16]||(l[16]=e=>n.value.description=e),rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}}),Ve=se(pe,[["__scopeId","data-v-aa8e3607"]]);export{Ve as default};
