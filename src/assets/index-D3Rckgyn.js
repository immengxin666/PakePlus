import{b as S}from"./index-edeq_iRc.js";import{g as te}from"./index-B4NkgLwq.js";import{r as U}from"./request-Taj1ukFo.js";import{c as ae}from"./index-Ds1LbG6U.js";import{d as le,r as p,a as R,m as ne,c as _,b as a,j as i,w as l,e as o,F as g,h as w,f as h,E as x,k as oe,o as d,g as k,i as Y,t as C,_ as se}from"./index-D4WkKyn4.js";const $="/dishes-service/cart",re=()=>U({url:`${$}`,method:"GET"}),A=f=>U({url:`${$}`,method:"POST",data:f}),ie=(...f)=>U({url:`${$}/${f}`,method:"DELETE"}),ue={class:"flex justify-end gap-5"},de={style:{padding:"14px"}},pe={class:"dishes"},ce={class:"ingredients"},me={class:"ingredients"},_e={class:"ingredients"},ge=le({__name:"index",setup(f){const B=p(),V=p(""),F=()=>{var t;const n=(((t=B.value)==null?void 0:t.getSelectionRows())??[]).map(r=>({dishesId:r.dishesId,dishesNum:r.count}));ae({prepareTime:V.value,itemList:n}).then(r=>{x.success("下单成功"),v()})},M=p([]),N=p([]),L=p([]),I=p([]),q=async()=>{N.value=await S("1"),L.value=await S("2"),I.value=await S("3"),M.value=[...N.value,...L.value,...I.value]},s=R({pageNum:1,pageSize:4,total:0,list:[]}),E=p(),u=R({}),m=()=>{te(s.pageNum,s.pageSize,u).then(n=>{s.total=n.total,s.list=n.rows})};ne(u,(n,t)=>{s.pageNum=1,m()});const z=p([]),v=async()=>{z.value=await re()},P=n=>{A(n).then(t=>{x.success("更新成功")})},j=async n=>{let t=z.value.find(r=>r.dishesId==n.id);t?t.count++:t={dishesId:n.id,dishesName:n.name,count:1},await A(t),x.success("加入预制订单成功"),v()},O=async n=>{await oe.confirm("确定要删除这个菜品吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ie(n.dishesId),x.success("删除成功"),v()};return q(),m(),v(),(n,t)=>{const r=o("el-table-column"),G=o("el-input-number"),b=o("el-button"),Q=o("el-table"),H=o("el-date-picker"),T=o("el-option"),D=o("el-select"),y=o("el-form-item"),J=o("el-form"),K=o("el-image"),W=o("el-card"),X=o("el-col"),Z=o("el-row"),ee=o("el-pagination");return d(),_(g,null,[a(Q,{ref_key:"cartListRef",ref:B,data:z.value,border:"",style:{width:"100%","margin-bottom":"20px"},"max-height":"300px"},{default:l(()=>[a(r,{type:"selection",width:"55",align:"center"}),a(r,{label:"序号",type:"index",align:"center",width:"80"}),a(r,{prop:"dishesName",label:"菜品名称",align:"center"}),a(r,{label:"数量",align:"center"},{default:l(({row:e})=>[a(G,{modelValue:e.count,"onUpdate:modelValue":c=>e.count=c,min:1,max:10,onChange:c=>P(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(r,{label:"操作",align:"center",width:"200"},{default:l(({row:e})=>[a(b,{type:"danger",onClick:c=>O(e)},{default:l(()=>t[8]||(t[8]=[w("删除")])),_:2,__:[8]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),i("div",ue,[a(H,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=e=>V.value=e),type:"date",placeholder:"请选择预制时间","disabled-date":e=>e<new Date,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","disabled-date"]),a(b,{type:"primary",onClick:F,icon:"Plus"},{default:l(()=>t[9]||(t[9]=[w("开始预制")])),_:1,__:[9]})]),a(J,{ref_key:"queryFormRef",ref:E,model:u,"label-width":"auto",inline:""},{default:l(()=>[a(y,{prop:"main"},{default:l(()=>[a(D,{modelValue:u.main,"onUpdate:modelValue":t[1]||(t[1]=e=>u.main=e),placeholder:"请选择主要食材",clearable:"",class:"w-50!"},{default:l(()=>[(d(!0),_(g,null,h(N.value,e=>(d(),k(T,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{prop:"minor"},{default:l(()=>[a(D,{modelValue:u.minor,"onUpdate:modelValue":t[2]||(t[2]=e=>u.minor=e),placeholder:"请选择辅助食材",clearable:"",class:"w-50!"},{default:l(()=>[(d(!0),_(g,null,h(L.value,e=>(d(),k(T,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{prop:"seasoning"},{default:l(()=>[a(D,{modelValue:u.seasoning,"onUpdate:modelValue":t[3]||(t[3]=e=>u.seasoning=e),placeholder:"请选择调味料",clearable:"",class:"w-50!"},{default:l(()=>[(d(!0),_(g,null,h(I.value,e=>(d(),k(T,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,null,{default:l(()=>[a(b,{type:"info",onClick:t[4]||(t[4]=e=>{var c;return(c=E.value)==null||c.resetFields(),s.pageNum=1,m()}),icon:"Refresh"},{default:l(()=>t[10]||(t[10]=[w("重置")])),_:1,__:[10]})]),_:1})]),_:1},8,["model"]),a(Z,{gutter:15},{default:l(()=>[(d(!0),_(g,null,h(s.list,e=>(d(),k(X,{span:6,key:e.id},{default:l(()=>[a(W,{"body-style":{padding:"0px"},style:{"margin-bottom":"10px"},shadow:"hover",class:"rounded-xl!"},{default:l(()=>[a(K,{src:Y(void 0)+e.url,"preview-src-list":[Y(void 0)+e.url],"preview-teleported":"",style:{width:"100%",display:"block",height:"350px"}},null,8,["src","preview-src-list"]),i("div",de,[i("div",pe,[i("span",null,"菜品名称："+C(e.name),1),a(b,{link:"",type:"primary",class:"button",onClick:c=>j(e)},{default:l(()=>t[11]||(t[11]=[w("加入预制订单")])),_:2,__:[11]},1032,["onClick"])]),i("div",ce,[i("span",null,"主要食材："+C(e.mainName),1)]),i("div",me,[i("span",null,"辅助食材："+C(e.minorName),1)]),i("div",_e,[i("span",null,"配料："+C(e.seasoningName),1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),a(ee,{"current-page":s.pageNum,"onUpdate:currentPage":t[5]||(t[5]=e=>s.pageNum=e),"page-size":s.pageSize,"onUpdate:pageSize":t[6]||(t[6]=e=>s.pageSize=e),"page-sizes":[4,8,12,20],background:"",class:"mt-5!",layout:"total, sizes, prev, pager, next, jumper",total:s.total,onSizeChange:t[7]||(t[7]=e=>(s.pageNum=1,m())),onCurrentChange:m},null,8,["current-page","page-size","total"])],64)}}}),xe=se(ge,[["__scopeId","data-v-a42d513f"]]);export{xe as default};
